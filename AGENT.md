# ğŸ“˜ Instagram Crawler Viewer â€” Developer Prompt (v1)

ë³¸ ë¬¸ì„œëŠ” Instagram í¬ë¡¤ë§ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ë‹¤ì¤‘ ê³„ì • ë·°ì–´ ì›¹ì„œë¹„ìŠ¤**ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ê°œë°œ ì§€ì‹œì„œì´ë‹¤.  
êµ¬í˜„ìëŠ” ì—¬ê¸° ëª…ì„¸ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•œë‹¤.

í”„ë¡œì íŠ¸ëŠ” ëª¨ë…¸ë ˆí¬ ë°©ì‹ìœ¼ë¡œ /apps/frontend, /apps/backend, (í•„ìš”ì‹œ)/apps/api ë“±ê³¼ ê°™ì´ êµ¬ë¶„

---

# âœ… 1. í”„ë¡œì íŠ¸ ê°œìš”

## ëª©ì 
`instaloader`ë¡œ ìˆ˜ì§‘í•œ **ë¡œì»¬ íŒŒì¼ ê¸°ë°˜ í¬ë¡¤ë§ ë°ì´í„°**ë¥¼ ëŒ€ìƒìœ¼ë¡œ  
ì—¬ëŸ¬ Instagram ê³„ì •ì„ í•œê³³ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ì›¹ ë·°ì–´ë¥¼ êµ¬ì¶•í•œë‹¤.

- ê° ê³„ì •ë³„ ê²Œì‹œë¬¼ ëª©ë¡ ì œê³µ
- ê²Œì‹œë¬¼ ìƒì„¸ì—ì„œ ì´ë¯¸ì§€/ë™ì˜ìƒ ìºëŸ¬ì…€ ì œê³µ
- ë³¸ë¬¸/í•´ì‹œíƒœê·¸ í‘œì‹œ
- í”„ë¡œí•„ ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬ ì œê³µ
- ë‚ ì§œ ê¸°ë°˜ í•„í„°
- í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë°˜ íƒìƒ‰
- ì¸ë„¤ì¼ ì„œë²„ ë„ì…ìœ¼ë¡œ ê³ í’ˆì§ˆ/ìµœì í™”ëœ ì´ë¯¸ì§€ ì œê³µ

---

# âœ… 2. ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±ë„
```text
+------------------------+      +-----------------------+
|      Frontend (SPA)    |      |    Admin Panel (SPA)  |
|   React / Tailwind     |      |   React / Tailwind    |
|------------------------|      |-----------------------|
| Profile Strip / Filter |      | Crawl Target Manager  |
| Feed (pagination)      |      | Crawl Account Manager |
| Post Modal             |      | Manual Session Input  |
|                        |      | Feed Exposure Toggle  |
+------------+-----------+      +-----------+-----------+
             |                               |
             |                               v
             |                    +-----------------------+
             |                    |   Authentik (OIDC)    |
             |                    |  Admin Auth Provider  |
             |                    +-----------+-----------+
             |                                |
             v                                v
+------------------------+      +----------------------+
|        API Server      |      |     Thumbnail        |
|  Node.js (Fastify)     |      |   Server (imgproxy)  |
|------------------------|      |----------------------|
|  - Accounts API        |      | - Resize / WebP/AVIF |
|  - Posts API           |      | - Cache-Control      |
|  - Profile gallery     |      |                      |
|  - Media file serving  |      +----------------------+
|  - DB sync/indexing    |
|  - Admin REST endpoints|
+------------+-----------+
             |
             v
+------------------------+
|        Postgres        |
|------------------------|
| accounts               |
| posts                  |
| media                  |
| profile_pics           |
| tags / post_tags       |
| crawl_targets          |
| crawl_accounts         |
| crawl_runs             |
+------------+-----------+
             |
             v
+-------------------------+
|    Crawler (Python)     |
|  instaloader ê¸°ë°˜       |
|-------------------------|
| /root/{account}/...     |
| profile_pic files       |
| post media + txt        |
+-------------------------+
```
---

# âœ… 2.1 ê´€ë¦¬ í˜ì´ì§€ ê°œìš”

ìš´ì˜ìëŠ” ë³„ë„ ì–´ë“œë¯¼ ê²½ë¡œ(`/admin` ê¶Œì¥)ë¥¼ í†µí•´ ê´€ë¦¬ í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤. í•´ë‹¹ ì˜ì—­ì€ **Authentik** ê¸°ë°˜ OIDC ì¸ì¦ì„ í•„ìˆ˜ë¡œ ê±°ì¹˜ë©°, í”„ë¡ íŠ¸ì—”ë“œ(SPA)ì—ì„œ í† í°ì„ ìˆ˜ì‹ í•œ ë’¤ API ì„œë²„ì˜ ì–´ë“œë¯¼ ì „ìš© ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•œë‹¤.

## ì£¼ìš” ë©”ë‰´

- **í¬ë¡¤ë§ ê´€ë¦¬**
  - í¬ë¡¤ë§ ëŒ€ìƒ Instagram ID ë“±ë¡/ìˆ˜ì •/ì‚­ì œ (DBë¡œ ê´€ë¦¬)
  - í¬ë¡¤ë§ ì‹œ ì‚¬ìš©í•  ë¡œê·¸ì¸ ê³„ì • ID ëª©ë¡ ê´€ë¦¬ (DBë¡œ ê´€ë¦¬)
  - ìˆ˜ë™ ì‹¤í–‰: `sessionId` ì…ë ¥ í›„ "í¬ë¡¤ë§ ì‹¤í–‰" ë²„íŠ¼ìœ¼ë¡œ APIì— í¬ë¡¤ë§ íŠ¸ë¦¬ê±° ìš”ì²­
  - ìµœê·¼ ì‹¤í–‰ ì´ë ¥ ë° ìƒíƒœ ëª¨ë‹ˆí„°ë§(ì„±ê³µ/ì‹¤íŒ¨, ì‹¤í–‰ ê³„ì •, íƒ€ì„ìŠ¤íƒ¬í”„)
- **í”¼ë“œ ê´€ë¦¬**
  - í™”ë©´ ë…¸ì¶œ ëŒ€ìƒ ID ì§€ì •: í¬ë¡¤ë§ ëŒ€ìƒ í…Œì´ë¸”ì— `is_featured` flag ì»¬ëŸ¼ì„ í† ê¸€
  - ë…¸ì¶œ ìˆœì„œ/ìš°ì„ ìˆœìœ„ ê´€ë¦¬(ì„ íƒ)
  - í”¼ë“œ í†µê³„(ì„ íƒ): ê²Œì‹œë¬¼ ìˆ˜, ìµœê·¼ ì—…ë°ì´íŠ¸ ì‹œê°„ ë“± ìš”ì•½ ì •ë³´ ì œê³µ

ëª¨ë“  ì–´ë“œë¯¼ APIëŠ” Authentik ë°œê¸‰ í† í° ê²€ì¦ ë° ì—­í•  í™•ì¸(ì˜ˆ: `admin` role claim)ì„ ê±°ì³ì•¼ í•œë‹¤.

---

# âœ… 3. ë°ì´í„° êµ¬ì¡°
## 3.1 íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°

```
/root/<account>/
  2025-11-02_19-30-52_UTC_profile_pic.jpg
  2025-11-02_19-40-12_UTC_1.jpg
  2025-11-02_19-40-12_UTC_2.mp4
  2025-11-02_19-40-12_UTC.txt
  ...
```

### ê·œì¹™
- `<timestamp>_UTC_{n}.jpg|mp4` â†’ ê²Œì‹œë¬¼ ë¯¸ë””ì–´
- `<timestamp>_UTC.txt` â†’ ë³¸ë¬¸
- `<timestamp>_UTC_profile_pic.jpg` â†’ í”„ë¡œí•„ ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬  
- JSON ë©”íƒ€ëŠ” **ì‚¬ìš©í•˜ì§€ ì•ŠìŒ**

---

# âœ… 4. ë°±ì—”ë“œ(DB) ìŠ¤í‚¤ë§ˆ

## accounts
- id (PK)
- latest_profile_pic_url
- created_at
- updated_at

## posts
- id (`YYYY-MM-DD_HH-mm-ss_UTC`)
- account_id FK
- posted_at
- caption
- has_text
- created_at

## media
- id PK
- post_id FK
- order_index
- filename
- mime
- width/height/duration (nullable)

## profile_pics
- id PK
- account_id FK
- taken_at
- filename

## crawl_targets
- id PK
- instagram_id (unique)
- display_name (nullable)
- is_active (bool)
- is_featured (bool) â€” ë©”ì¸ í”¼ë“œ ë…¸ì¶œ ì—¬ë¶€
- created_at
- updated_at

## crawl_accounts
- id PK
- login_id (unique)
- description (nullable)
- last_session_id (nullable)
- in_use (bool)
- created_at
- updated_at

## crawl_runs
- id PK
- trigger_type (`manual`|`scheduled`)
- crawl_account_id FK
- session_id (nullable)
- started_at / finished_at
- status (`pending`|`running`|`success`|`failed`)
- error_message (nullable)
- initiated_by (Authentik user id)

## tags / post_tags
- ë‹¨ë°©í–¥ Many-to-Many
- captionì—ì„œ í•´ì‹œíƒœê·¸ íŒŒì‹±

---

# âœ… 5. API ëª…ì„¸

## 5.1 Accounts ê´€ë ¨

### GET /api/accounts
```json
{
  "items": [
    { "account": "aaa", "latestProfileUrl": "/thumb/w80/...jpg" },
    { "account": "bbb", "latestProfileUrl": "/thumb/w80/...jpg" }
  ]
}
```

### GET /api/profile/:account
```json
{
  "account": "aaa",
  "profiles": [
    { "url": "...jpg", "timestamp": "2025-11-02T19:30:52Z" }
  ]
}
```

---

## 5.2 Posts API

### GET /api/posts
- í˜ì´ì§•: í‚¤ì…‹ ê¸°ë°˜  
- í•„í„°: account[], date_from, date_to

```json
{
  "items": [
    {
      "id": "2025-11-02_19-40-12_UTC",
      "account": "aaa",
      "postedAt": "2025-11-02T19:40:12Z",
      "thumbnail": "/thumb/w360/aaa/2025-11-02_19-40-12_UTC_1.jpg",
      "captionExcerpt": "ë³¸ë¬¸ ìš”ì•½...",
      "tags": ["ì—¬í–‰", "ì„œìš¸"]
    }
  ],
  "nextCursor": "...."
}
```

### GET /api/posts/:account/:postId
- ê²Œì‹œë¬¼ ìƒì„¸
```json
{
  "id": "...",
  "account": "aaa",
  "postedAt": "2025-11-02T19:40:12Z",
  "caption": "...ì „ì²´ë³¸ë¬¸...",
  "tags": ["ì—¬í–‰"],
  "media": [
    { "order": 1, "type": "image", "url": "/media/aaa/..._1.jpg" },
    { "order": 2, "type": "video", "url": "/media/aaa/..._2.mp4" }
  ]
}
```

---

## 5.3 Media API
### GET /media/:account/:filename
- ì´ë¯¸ì§€/ë™ì˜ìƒ ì›ë³¸ íŒŒì¼ ì„œë¹™  
- Range ì§€ì›

---

# âœ… 6. ì¸ë„¤ì¼ ì„œë²„
- ì„œë¹„ìŠ¤ëª…: thumb
- ì¶”ì²œ: imgproxy, ì„±ëŠ¥ ìš°ìˆ˜ / ìºì‹± ìë™í™”
## URL íŒ¨í„´
```text
/thumb/w{width}/{account}/{filename}
```
- ì¶œë ¥ í¬ë§·:
  - WebP / AVIF ìš°ì„  
  - JPG í´ë°± 
  - ê°• ìºì‹œ: Cache-Control: public, max-age=31536000, immutable
- ì£¼ìš” í”„ë¦¬ì…‹
  - í”„ë¡œí•„ ìŠ¤íŠ¸ë¦½: w=80
  - í”¼ë“œ ì¹´ë“œ: w=360
  - ë¯¸ë””ì–´ ìƒì„¸: w=1080
---

# âœ… 7. í”„ëŸ°íŠ¸ì—”ë“œ(UI) ìš”êµ¬ì‚¬í•­

í”„ëŸ°íŠ¸ì—”ë“œëŠ” React ê¸°ë°˜ SPA(Single Page Application)ìœ¼ë¡œ ì‘ì„±í•œë‹¤.  
React Router, React Query, Tailwind CSS ì‚¬ìš©ì„ ëª…ì‹œí•œë‹¤.

---

## 7.1 ì „ì²´ êµ¬ì¡°

### ê³µí†µ ê¸°ìˆ  ìŠ¤íƒ
- React 18+
- React Router
- React Query
- Tailwind
- Axios ë˜ëŠ” Fetch
- IntersectionObserver(í•„ìš” ì‹œ)
- TypeScript

### ê³µí†µ ê¸°ëŠ¥
- URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë™ê¸°í™”
- ìƒíƒœ ìºì‹±
- ë¡œë”©/ì—ëŸ¬ ìŠ¤ì¼ˆë ˆí†¤
- ë°˜ì‘í˜• UI

---

## 7.2 ìƒë‹¨ í”„ë¡œí•„ ìŠ¤íŠ¸ë¦½ (Sticky)

### í™”ë©´ êµ¬ì„±
- ìƒë‹¨ ê³ ì •(sticky top-0)
- ê°€ë¡œ ìŠ¤í¬ë¡¤ ë¦¬ìŠ¤íŠ¸
- í”„ë¡œí•„ ì´ë¯¸ì§€(ì¸ë„¤ì¼) + ì•„ì´ë”” í…ìŠ¤íŠ¸

### ë™ì‘
- ì•„ì´ë”” í´ë¦­ â†’ ì„ íƒ ê³„ì • í•„í„°ì— ì¶”ê°€
- í”„ë¡œí•„ ì´ë¯¸ì§€ í´ë¦­ â†’ `/profile/:account` ë¼ìš°íŒ…
- í˜„ì¬ ì„ íƒëœ ê³„ì •ì€ ê°•ì¡° ìƒíƒœ í‘œì‹œ

---

## 7.3 í•„í„° ë°” (Sticky)

### êµ¬ì„± ìš”ì†Œ
- ë‚ ì§œ ë²”ìœ„ ì„ íƒê¸°(Date Range Picker)
- ì •ë ¬(ìµœì‹ /ì˜¤ë˜ëœìˆœ)
- ë¦¬ì…‹ ë²„íŠ¼

### ë™ì‘
- í•„í„° ë³€ê²½ ì‹œ URL ì¿¼ë¦¬ ë°˜ì˜
    - `?accounts=a,b&date_from=YYYY-MM-DD&date_to=YYYY-MM-DD&sort=desc`
- í•„í„° ì ìš© ì‹œ ìµœì´ˆ í˜ì´ì§€ë¶€í„° ë‹¤ì‹œ ë¡œë“œ

---

## 7.4 í”¼ë“œ ê·¸ë¦¬ë“œ (í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë°˜)

### ì¹´ë“œ êµ¬ì„±
- ì¸ë„¤ì¼(360px ë¦¬ì‚¬ì´ì¦ˆ)
- ê³„ì •ëª…
- ê²Œì‹œì¼(Date)
- ìº¡ì…˜ ìš”ì•½
- í•´ì‹œíƒœê·¸ ì¼ë¶€

### ë™ì‘
- `GET /api/posts` í˜¸ì¶œí•˜ì—¬ 1í˜ì´ì§€ ë¡œë“œ
- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ í´ë¦­ â†’ ë‹¤ìŒ cursor ë¡œë”©
- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ â†’ ì´ì „ cursor ë¡œë”©
- ë¬´í•œ ìŠ¤í¬ë¡¤ì´ ì•„ë‹ˆë¼ "ì´ì „/ë‹¤ìŒ" ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜

---

## 7.5 ê²Œì‹œë¬¼ ìƒì„¸ (Modal + Routing)

### ë¼ìš°íŠ¸
- `/p/:account/:postId`

### UI êµ¬ì„±
- ì¤‘ì•™ ëª¨ë‹¬ ë˜ëŠ” full-screen ë°˜ì‘í˜•
- ì¢Œì¸¡: ì´ë¯¸ì§€/ì˜ìƒ ìºëŸ¬ì…€
- ìš°ì¸¡/í•˜ë‹¨: caption, tags, postedAt, account

### ë™ì‘
- ESCë¡œ ë‹«ê¸°
- ë’¤ë¡œê°€ê¸° ê°€ëŠ¥(ë¼ìš°íŒ… ìœ ì§€)
- ìºëŸ¬ì…€:
    - í‚¤ë³´ë“œ â† â†’
    - ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„

---

## 7.6 í”„ë¡œí•„ íˆìŠ¤í† ë¦¬ í˜ì´ì§€

### ë¼ìš°íŠ¸
- `/profile/:account`

### êµ¬ì„±
- ëª¨ë“  í”„ë¡œí•„ ì‚¬ì§„ ëª©ë¡ í‘œì‹œ
- ìµœì‹ ìˆœ/ì˜¤ë˜ëœìˆœ í† ê¸€
- ë¼ì´íŠ¸ë°•ìŠ¤ ë·°ì–´ íƒ‘ì¬

---

## 7.7 ì—ëŸ¬/ë¡œë”© ì²˜ë¦¬

- ê³µí†µ ìŠ¤ì¼ˆë ˆí†¤
- API ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë²„íŠ¼
- Post ìƒì„¸ API ì‹¤íŒ¨ ì‹œ ëª¨ë‹¬ ë‚´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ

---
# âœ… 8. Crawler ìš”êµ¬ì‚¬í•­

## 8.1 ê¸°ìˆ  ìŠ¤íƒ
- Python 3.12+
- instaloader
- pathlib
- urllib (í”„ë¡œí•„ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œìš©)

## 8.2 ë™ì‘ ëª©ì 
`targets/targets.txt` ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ê° ê³„ì •ì˜:
- ìµœì‹  í”„ë¡œí•„ ì´ë¯¸ì§€
- ê²Œì‹œë¬¼ ì´ë¯¸ì§€/ì˜ìƒ
- ë³¸ë¬¸ í…ìŠ¤íŠ¸(.txt)

ì„ `/root/<account>/` ì•„ë˜ì— ì €ì¥í•œë‹¤.  
**JSON ë©”íƒ€ëŠ” ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.**

## 8.3 ì…ë ¥: targets.txt ê·œì¹™
```
aaa, bbb
ccc
ddd, eee
```
- ì½¤ë§ˆ ë˜ëŠ” ì¤„ë°”ê¿ˆ ëª¨ë‘ í—ˆìš©
- ê³µë°± ì œê±° í›„ ë¬¸ìì—´ë§Œ ê³„ì •ìœ¼ë¡œ ì²˜ë¦¬

## 8.4 ì¶œë ¥ êµ¬ì¡°
```
/root/<account>/
  2025-11-02_19-30-52_UTC_profile_pic.jpg
  2025-11-02_19-40-12_UTC_1.jpg
  2025-11-02_19-40-12_UTC_2.mp4
  2025-11-02_19-40-12_UTC.txt
```

## 8.5 ë™ì‘ ê·œì¹™

### âœ… í”„ë¡œí•„ ì´ë¯¸ì§€
- UTC timestamp ìƒì„±
- íŒŒì¼ëª…: `<timestamp>_profile_pic.jpg`
- íˆìŠ¤í† ë¦¬ ëˆ„ì  ì €ì¥

### âœ… ê²Œì‹œë¬¼
- instaloader filename pattern:
  `{date_utc}_UTC_{num}`
- ì´ë¯¸ì§€/ì˜ìƒ ì €ì¥
- ìº¡ì…˜ì€ `<prefix>.txt` ë¡œ ì €ì¥

### âœ… ë¡œê·¸ì¸ ì²˜ë¦¬
- IG_USERNAME, IG_PASSWORD ì œê³µ ì‹œ ë¡œê·¸ì¸
- ì„¸ì…˜ íŒŒì¼ `/sessions/<username>.session` ì¬ì‚¬ìš©

### âœ… ì‹¤íŒ¨ ì²˜ë¦¬
- ì‹¤íŒ¨ íŒŒì¼ ë¡œê·¸ë§Œ ì¶œë ¥í•˜ê³  ê³„ì† ì§„í–‰

---

# âœ… 9. ì¸ë±ì‹± / DB ë¦¬í”„ë ˆì‹œ

API ì„œë²„ëŠ” `/root` íŒŒì¼ êµ¬ì¡°ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ìŠ¤ìº”í•˜ì—¬ DBì™€ ë™ê¸°í™”í•œë‹¤.

## 9.1 ìŠ¤ìº” íŠ¸ë¦¬ê±°
- ì„œë²„ ì‹œì‘ ì‹œ ì „ì²´ ìŠ¤ìº”
- ê´€ë¦¬ì í˜¸ì¶œ `/api/admin/reindex`
- í¬ë¡¤ëŸ¬ ì™„ë£Œ í›„ Hook(ì„ íƒ)

## 9.2 ì¸ë±ì‹± ë¡œì§
1. `/root` ë‚´ account í´ë” íƒìƒ‰
2. ê° íŒŒì¼ëª… prefixì—ì„œ timestamp, order_index, ì¢…ë¥˜ íŒŒì‹±
3. DB ì—…ì„œíŠ¸ ìˆ˜í–‰:
    - accounts
    - posts
    - media
    - profile_pics
    - tags / post_tags
4. accounts.latest_profile_pic_url ê°±ì‹ 

## 9.3 í•´ì‹œíƒœê·¸ íŒŒì‹±
ì •ê·œì‹:
```
/#([^\s#.,!?;:]+)/g
```

## 9.4 ì‚­ì œ ì •ì±…
- ì‹¤ì œ íŒŒì¼ ì‚­ì œëŠ” í•˜ì§€ ì•ŠìŒ
- orphan post/media ì‚­ì œëŠ” ë³„ë„ ë°°ì¹˜ ì˜µì…˜

---

# âœ… 10. ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

## 10.1 ì„±ëŠ¥
- Feed API ì‘ë‹µ â‰¤ 200ms (DB Hit ê¸°ì¤€)
- Thumbnail ì„œë²„ëŠ” WebP/AVIF ê°• ìºì‹œ
- ë™ì˜ìƒì€ Range ìš”ì²­ í•„ìˆ˜

## 10.2 í™•ì¥ì„±
- `/root` ëŒ€ì‹  S3/MinIOë¡œ ì´ì „ ê°€ëŠ¥í•˜ë„ë¡ ì¶”ìƒí™”
- ì¸ë„¤ì¼ ì„œë²„ imgproxy/Thumborë¡œ êµì²´ ê°€ëŠ¥

## 10.3 ë³´ì•ˆ
- ê´€ë¦¬ì í˜ì´ì§€ Basic Auth ë˜ëŠ” ì„¸ì…˜ ì¸ì¦
- Rate-limit ì˜µì…˜
- ë¯¸ë””ì–´ ê²½ë¡œëŠ” ì½ê¸° ì „ìš©

## 10.4 ë°±ì—…
- DB backup cron
- `/root` ë°ì´í„° snapshot

## 10.5 ì¥ì•  ì²˜ë¦¬
- íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë¡œê·¸ ì¶œë ¥ í›„ ìŠ¤í‚µ
- DB ì—…ì„œíŠ¸ ì‹¤íŒ¨ ì‹œ rollback í›„ ì¬ì²˜ë¦¬
- í¬ë¡¤ ì¤‘ë‹¨ â†’ instaloaderê°€ ë‹¤ìŒ ì‹¤í–‰ì—ì„œ ì²˜ë¦¬

---

# âœ… 11. Docker êµ¬ì¡°

## 11.1 Services

### âœ… api
- Node.js Fastify
- Posts/Accounts/Profile API
- Media Range ì„œë¹™
- DB ì¸ë±ì‹±
- Static frontend(optional)

### âœ… crawler
- Python instaloader
- ìŠ¤í¬ë¦½íŠ¸ëŠ” ë³„ë„ë¡œ ì œê³µ ì˜ˆì •. python script ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„ë§Œ êµ¬í˜„í•  ê²ƒ.

### âœ… thumb
- imgproxy ë˜ëŠ” sharp ê¸°ë°˜ ì´ë¯¸ì§€ ë³€í™˜
- `/thumb/w{width}/{account}/{filename}`
- WebP/AVIF + immutable ìºì‹œ

### âœ… db
- PostgreSQL
- docker volume ì €ì¥

### âœ… redis(optional)
- API ê²°ê³¼ ìºì‹±

## 11.2 ê³µìœ  ë³¼ë¥¨
```
data_root:   # /root
sessions:    # instaloader ì„¸ì…˜
pg_data:     # postgres
```

## 11.3 docker-compose ì˜ˆì‹œ íë¦„
- api â†’ /root ì½ê¸°, DB ì—°ê²° 
- crawler â†’ /root ì“°ê¸° 
- thumb â†’ /root ì½ê¸° 
- db â†’ ëª¨ë“  ë©”íƒ€ë°ì´í„° ê´€ë¦¬

---

# âœ… 12. ê°œë°œ ì™„ë£Œ ê¸°ì¤€(AC)

## ê¸°ëŠ¥ ê¸°ì¤€
- [ ] ê³„ì • ëª©ë¡/ì¸ë„¤ì¼ ì¶œë ¥
- [ ] ê³„ì • ì„ íƒ ê¸°ë°˜ post í•„í„°ë§
- [ ] ë‚ ì§œ ë²”ìœ„ í•„í„° ë™ì‘
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë°˜ feed íƒìƒ‰
- [ ] ìƒì„¸ ëª¨ë‹¬ + ë¼ìš°íŒ… ì •ìƒ
- [ ] í”„ë¡œí•„ íˆìŠ¤í† ë¦¬ ì •ìƒ ë™ì‘

## ê´€ë¦¬ í˜ì´ì§€ ê¸°ì¤€
- [ ] Authentik OIDC ì—°ë™ ë° ì–´ë“œë¯¼ ì „ìš© ê²½ë¡œ ë³´í˜¸
- [ ] í¬ë¡¤ë§ ëŒ€ìƒ ID CRUD + is_active/is_featured í† ê¸€
- [ ] í¬ë¡¤ë§ ë¡œê·¸ì¸ ê³„ì • CRUD + ì„¸ì…˜ ì…ë ¥
- [ ] sessionId ì…ë ¥ ê¸°ë°˜ ìˆ˜ë™ í¬ë¡¤ë§ ì‹¤í–‰ ë° ìƒíƒœ í‘œì‹œ
- [ ] í”¼ë“œ ë…¸ì¶œ ëŒ€ìƒ/ìˆœì„œ ê´€ë¦¬ UI ì œê³µ

## ë°±ì—”ë“œ ê¸°ì¤€
- [ ] íŒŒì¼ â†’ DB ì¸ë±ì‹± 100%
- [ ] posts/media/txt ë§¤í•‘ ì •í™•
- [ ] ë™ì˜ìƒ Range ì§€ì›
- [ ] ì¸ë„¤ì¼ ì„œë²„ ì—°ë™
- [ ] ì–´ë“œë¯¼ API ì¸ì¦/ì¸ê°€(Authentik í† í° ê²€ì¦)
- [ ] crawl_targets / crawl_accounts / crawl_runs í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë°˜ì˜ ë° ë§ˆì´ê·¸ë ˆì´ì…˜

## í¬ë¡¤ëŸ¬ ê¸°ì¤€
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ ëˆ„ì  ì €ì¥
- [ ] ë¯¸ë””ì–´/ìº¡ì…˜ ì €ì¥ ê·œì¹™ ì¼ì¹˜
- [ ] ì„¸ì…˜ ì¬ì‚¬ìš©
- [ ] ì „ì²´ ê³„ì • ì²˜ë¦¬ ì„±ê³µë¥  100%

## ì„±ëŠ¥ ê¸°ì¤€
- [ ] Feed ì‘ë‹µ < 200ms
- [ ] Thumbnail ë¡œë”© ìµœì í™”

## Docker ê¸°ì¤€
- [ ] docker compose up -d ë¡œ ì „ì²´ ì‹¤í–‰
- [ ] api/crawler/thumb/db ì •ìƒ ê¸°ë™

## ë¬¸ì„œ ê¸°ì¤€
- [ ] /plans/plan{$number}.md ë¬¸ì„œ ìƒì„±
- [ ] ê° plan ë¬¸ì„œì— ì²´í¬ë¦¬ìŠ¤íŠ¸/ìƒíƒœ í¬í•¨
- [ ] README ì„¤ì¹˜/ì‹¤í–‰ ê°€ì´ë“œ í¬í•¨


---

# âœ… 13. ìš”ì²­ì‚¬í•­

ë³¸ í”„ë¡œì íŠ¸ëŠ” **/plans í´ë” ë‚´ì— ì‘ì—… ê³„íšì„œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.**

## ìš”êµ¬ì‚¬í•­

### 1) ë””ë ‰í„°ë¦¬ êµ¬ì¡°
```
/plans/
  plan1.md
  plan2.md
  plan3.md
  ...
```

### 2) plan{$number}.md êµ¬ì„± ê·œì¹™
ê° íŒŒì¼ì€ ë‹¤ìŒ í•­ëª©ì„ í¬í•¨í•´ì•¼ í•œë‹¤:

#### âœ… ì œëª©
ì˜ˆ) `Plan 1 â€” í”„ëŸ°íŠ¸ì—”ë“œ ì´ˆê¸° ì„¸íŒ…`

#### âœ… ì‘ì—… ëª©í‘œ
í•´ë‹¹ Planì—ì„œ ì²˜ë¦¬í•´ì•¼ í•  ê¸°ëŠ¥/ëª¨ë“ˆ ì •ì˜

#### âœ… ìƒì„¸ ì‘ì—… í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸
ì˜ˆ)
```
- [ ] React í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- [ ] Router êµ¬ì„±
- [ ] QueryProvider ì„¸íŒ…
```

#### âœ… ì˜ˆìƒ ì‚°ì¶œë¬¼
ì½”ë“œ/ë¬¸ì„œ/API ë“±

#### âœ… ì™„ë£Œ ì—¬ë¶€
```
status: pending | in-progress | done
```

#### âœ… í•„ìš” ê¸°ìˆ /ì°¸ê³  ë¬¸ì„œ (ì„ íƒ)

---

# âœ… 14. ìš”ì²­ì‚¬í•­

ì´ ë¬¸ì„œì— ì •ì˜ëœ ìš”êµ¬ì‚¬í•­ì„ ê¸°ë°˜ìœ¼ë¡œ:

- ì „ì²´ êµ¬í˜„
- /plans í´ë” ì‘ì„±
- ê° Plan ë¬¸ì„œì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
ë¥¼ ìˆ˜í–‰í•œë‹¤.




ëª¨ë“  êµ¬í˜„ì€ ì´ Developer Promptë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.


